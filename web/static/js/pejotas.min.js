/**
 * pejotas 4.0.0
 * @license ARV Klerix @ 2016 
 * @author: Jordi Aguilar <klerix.com>
 */
var $pjs=$pjs||{server:"http://localhost:8080/",version:"4.0.0",divs:{},index:"/eventos",controllers:{},views:{}};$pjs.director={render:function(a){$pjs.divs.main=$('<div class="pjs" />').appendTo(a),$pjs.director._drawMenu(),$pjs.director._drawBody(),$pjs.spinner._draw(),$pjs.director._initRouter()}},$pjs.render=function(a){$pjs.director.render(a)},$pjs.director._drawMenu=function(){$pjs.divs["menu-container"]=$('<div class="pjs-menu-container" />').appendTo($pjs.divs.main),$pjs.divs.menu=$('<div class="pjs-menu" />').appendTo($pjs.divs["menu-container"]),$('<span style="cursor: pointer;" title="Volver al inicio"><span class="pjs-header"><i class="ra '+$pjs.director._rndLogo()+'" aria-hidden="true"></i> Creador de Pejotas</span> <em>v'+$pjs.version+"</em></span>").linkTo("/").appendTo($pjs.divs.menu);var a=$("<menu />").appendTo($pjs.divs.menu);$('<span id="pjs-menu-selector"></span>').appendTo(a);for(var e=0;e<$pjs.director.menuItems.length;e++){var i=$pjs.director.menuItems[e];$pjs.director._drawMenuItem(a,i)}},$pjs.director._drawMenuItem=function(a,e){var i='<a title="'+e.name+'"><i class="'+e.icon+'" aria-hidden="true"></i></a>';$(i).on("mouseout",function(a){$("#pjs-menu-selector").text("")}).on("mouseover",function(a){$("#pjs-menu-selector").text(this.title)}).linkTo(e.route).appendTo(a)},$pjs.director._rndLogo=function(a,e){var i=["ra-player-thunder-struck","ra-player-pyromaniac","ra-falling","ra-muscle-fat","ra-hydra","ra-wolf-howl","ra-burning-meteor","ra-hood","ra-castle-emblem"];return i[Math.floor(Math.random()*i.length)]},$pjs.director._drawBody=function(){$pjs.divs["body-container"]=$('<div class="pjs-body-container" />').appendTo($pjs.divs.main),$pjs.divs.body=$('<div class="pjs-body" />').appendTo($pjs.divs["body-container"])},$pjs.spinner={show:function(){$pjs.divs.loader.jqxLoader("open"),$("div.jqx-tooltip").remove()},hide:function(){$pjs.divs.loader.jqxLoader("close")},_draw:function(){$pjs.divs.loader=$('<div id="jqxLoader" />').appendTo($pjs.divs.main),$pjs.divs.loader.jqxLoader({width:150,height:100,text:"Cargando..."})}},$pjs.ajax=function(a,e){var i=$.ajax({url:$pjs.server+a,dateType:"json"});i.done(function(a){e(a)}),i.fail(function(a,e,i){$pjs.notify("La conexi&oacute;n no se ha podido establecer.","error"),console.error("Ajax request failed",i),$pjs.spinner.hide()})},$pjs.notify=function(a,e){e=e||"error",$('<div style="margin: 0 auto"><div>'+a+"</div></div>").jqxNotification({opacity:.9,autoOpen:!0,appendContainer:".pjs-body",template:e}).on("close",function(){this.remove()})},$pjs.router=new Navigo,$pjs.director._initRouter=function(){$pjs.router.on($pjs.controllers).resolve(),$pjs.router.on("/",function(){$pjs.controllers[$pjs.index]()}).resolve()},$.extend($pjs.controllers,{"/eventos":function(a){$pjs.spinner.show(),$pjs.ajax("eventos",function(a){$pjs.divs.body.empty(),$("<h2>Eventos</h2>").appendTo($pjs.divs.body),$pjs.views.Eventos.list(a).appendTo($pjs.divs.body),$pjs.spinner.hide()})}}),$.extend($pjs.controllers,{"/habilidades/listar":function(a){$pjs.spinner.show(),$pjs.ajax("habilidades",function(a){$pjs.ajax("rasgos",function(e){$pjs.divs.body.empty();var i=$('<div class="lista" />').appendTo($pjs.divs.body),s={};location.hash&&(s.selectedItem=location.hash[1]),$pjs.views.tabs({Habilidades:$pjs.views.Habilidad.listar(a),Rasgos:$pjs.views.Rasgo.listar(e)},s).on("selected",function(a){$pjs.router.pause(!0),window.location.hash=a.args.item,$pjs.router.pause(!1)}).appendTo(i),$pjs.spinner.hide()})})},"/habilidades/mostrar/:id":function(a){$pjs.spinner.show(),$pjs.ajax("habilidades/"+a.id,function(a){$pjs.divs.body.empty();var e=new $pjs.views.Habilidad(a);e.drawView().appendTo($pjs.divs.body),$pjs.spinner.hide()})}}),$.extend($pjs.controllers,{"/personajes/subir":function(a){$pjs.divs.body.html("upload")}}),$.extend($pjs.controllers,{"/rasgos/mostrar/:id":function(a){$pjs.spinner.show(),$pjs.ajax("rasgos/"+a.id,function(a){$pjs.divs.body.empty();var e=new $pjs.views.Rasgo(a);e.drawView().appendTo($pjs.divs.body),$pjs.spinner.hide()})}}),$pjs.views.Eventos={list:function(a){var e=$('<div class="pjs-wrapper" />').appendTo($pjs.divs.body);return $.each(a,function(a,i){$pjs.views.Eventos.view(i).appendTo(e)}),e},view:function(a){var e=$('<div class="pjs-box pjs-evento" />'),i="<h3>"+a.nombre+"</h3><p>"+a.descripcion+"</p>";return a.custom_logo?e.css("background","url("+a.custom_logo+") no-repeat"):e.html('<div style="padding: 5px">'+i+"</div>"),e.jqxTooltip({content:i,position:"mouse"}),e.linkTo("/personajes/e"+a.id),e}},$pjs.views.Habilidad=function(a){this.data=a,this.data.className=$pjs.nameToClass(a.nombre)},$pjs.views.Habilidad.listar=function(a){var e="",i=$('<div class="pjs-wrapper" />');return $.each(a,function(a,s){e!=s.categoria&&(e=s.categoria,$("<div style='float: left; margin: 0 10px; width: 80%;'><h3>"+e+"</h3></div>").appendTo(i));var t=new $pjs.views.Habilidad(s);t.drawItem({"class":"linkable"}).appendTo(i)}),i},$pjs.views.Habilidad.prototype={getIcon:function(){return'<div class="pjs-icon icon-'+this.data.className+'" style="background-image:url(../static/images/habilidades/'+this.data.className+'.gif)" />'},getEffects:function(a,e){return'<div class="pjs-effects" style="'+a+'">'+$pjs.views.translateEffects(this.data.efecto,e)+"</div>"},getLetania:function(){return"-"!=this.data.letania?"<p><strong>Letan&iacute;a:</strong> <em>"+this.data.letania+"</em></p>":""},getTooltip:function(){return"<div>"+this.getEffects("float: right",!1)+this.getIcon()+"<strong>"+this.data.nombre+"</strong><br /><em>"+this.data.categoria+", "+this.data.tipo+"</em><br />"+this.getResumen(200)+this.getLetania()+"</div>"},getResumen:function(a){return a=a||55,this.data.descripcion.length>a?this.data.descripcion.substring(0,a)+"...":this.data.descripcion},drawItem:function(a){a=a||{};var e=$('<div class="pjs-box pjs-skill '+a["class"]+'" style="'+a.style+'" />');$(this.getEffects("float: right",!1)).appendTo(e),$(this.getIcon()).appendTo(e),$("<div><strong>"+this.data.nombre+'</strong><br /><span style="color: darkgray">'+this.data.categoria+", "+this.data.tipo+"</span></div>").appendTo(e),e.jqxTooltip({content:this.getTooltip(),position:"mouse",width:"400px"});return e.linkTo("/habilidades/mostrar/"+this.data.id),e},drawView:function(){var a=$("<div />"),e=$('<div style="float: right; width: 250px;" />').appendTo(a);if(this.drawRequirement().appendTo(e),this.data.clases){var i=$('<div style="" class="pjs-infobox"/>').appendTo(e);$("<strong>Clases:</strong><ul>").appendTo(i);for(var s in this.data.clases)var t=this.data.clases[s],n=$("<li />").addLinkTo("/personajes/c"+t.id,t.nombre).append(" por <strong>"+(this.data.ph+t.extraph)+"PHs</strong>").appendTo(i);$("</ul>").appendTo(i)}return $("<div>"+this.getEffects("float:right")+this.getIcon()+"<h2>"+this.data.nombre+'</h2><span style="color: darkgray"><strong>Tipo:</strong> '+this.data.categoria+", "+this.data.tipo+'</span></div></div><div style="text-align: justify">'+this.data.descripcion+"</div>"+this.getLetania()+"<br/><br/>").appendTo(a),a.addLinkTo("/habilidades/listar/#0","&lt; Lista de Habilidades"),a},drawRequirement:function(){var a=$('<div style="text-align: right; margin: 0 0 10px 15px;"><strong>Requisito:</strong></div>');if(this.data.habilidad){var e=new $pjs.views.Habilidad(this.data.habilidad[0]);return a.append(e.drawItem({style:"float: none; width: 223px; cursor: pointer; margin: 0"}))}return a.append(" Ninguno")}},$pjs.director.menuItems=[{name:"Inicio",icon:"ra ra-wooden-sign",route:"/"},{name:"Listar Habilidades y Rasgos",icon:"ra ra-spades-card",route:"/habilidades/listar/#0"},{name:"Subir personaje",icon:"ra ra-player-teleport",route:"personajes/subir/"}],$pjs.views.Rasgo=function(a){this.data=a,this.data.className=$pjs.nameToClass(a.nombre)},$pjs.views.Rasgo.listar=function(a){var e=$('<div class="pjs-wrapper" />');return $("<div style='float: left; margin: 0 10px; width: 80%;'><h3>Rasgos</h3></div>").appendTo(e),$.each(a,function(a,i){var s=new $pjs.views.Rasgo(i);s.drawItem({"class":"linkable"}).appendTo(e)}),e},$pjs.views.Rasgo.prototype={drawIcon:function(){return'<div class="pjs-icon icon-'+this.data.className+'" style="background-image:url(../static/images/rasgos/'+this.data.className+'.gif)" />'},drawTooltip:function(a){var e="<div>"+this.drawEffects("float: right")+this.drawIcon()+'<strong style="font-size: 12px; line-height: 24px">'+this.data.nombre+"</strong><br/><strong>Tipo:</strong> <em>"+this.data.tipo+"</em><br />"+this.getResumen(55)+"</div>";a.jqxTooltip({content:e,position:"mouse",autoHide:!1,width:"400px"})},drawEffects:function(a){return'<div class="pjs-effects" style="'+a+'">'+$pjs.views.translateEffects(this.data.efecto)+"</div>"},drawItem:function(a){a=a||{};var e=$('<div class="pjs-box pjs-skill '+a["class"]+'" />');return $('<div style="float: right; color: darkgray;">'+this.data.tipo+"</div>").appendTo(e),$(this.drawIcon()).appendTo(e),$("<div><strong>"+this.data.nombre+"</strong><br /><span>"+this.getResumen()+"</span></div>").appendTo(e),this.drawTooltip(e),e.linkTo("/rasgos/mostrar/"+this.data.id),e},drawView:function(){var a=$("<div />"),e=$('<div style="float: right" class="pjs-infobox"><strong>Tipo:</strong> '+this.data.tipo+"<br /></div>").appendTo(a);if(this.data.arquetipos){var i=$("<div/>").appendTo(e);$("<hr/><br /><strong>Arquetipos:</strong><ul>").appendTo(i);for(var s in this.data.arquetipos)var t=this.data.arquetipos[s],n=$("<li />").addLinkTo("/personajes/a"+t.id,t.nombre).appendTo(i);$("</ul>").appendTo(i)}return $("<div>"+this.drawEffects("float:right")+this.drawIcon()+"<h2>"+this.data.nombre+'</h2></div><div style="text-align: justify">'+this.data.descripcion+"</div><br/><br/>").appendTo(a),a.addLinkTo("/habilidades/listar/#1","&lt; Lista de Ragos"),a},getResumen:function(){return this.data.descripcion.length>55?this.data.descripcion.substring(0,55)+"...":this.data.descripcion}},$pjs.views.tabs=function(a,e){var i=$('<div class="pjs-tabs" />').appendTo($pjs.divs.body),s=$("<ul/>").appendTo(i);for(var t in a){var n=a[t];if("string"==typeof n)$("<div>"+n+"</div>").appendTo(i);else{var o=$("<div />").appendTo(i);n.appendTo(o)}$("<li>"+t+"</li>").appendTo(s)}return i.jqxTabs(e||{}),i},$pjs.views.translateDict={nr:{icon:"ra-diamond",name:"Nivel de Recursos"},ns:{icon:"ra-pyramids",name:"Nivel de Suministros/Ciclo"},moral:{icon:"ra-horn-call",name:"Moral"},sanar:{icon:"ra-health",name:"Sanar"},bendicion:{icon:"ra-health-increase",name:"Bendici&oacute;n"},maldicion:{icon:"ra-health-decrease",name:"Maldición"},"r:saber":{icon:"ra-book",name:"Rasgo: Saber"},"r:comercio":{icon:"ra-wooden-sign",name:"Rasgo: Comercio"},"r:alquimia":{icon:"ra-potion",name:"Rasgo: Alquimia"},"r:herreria":{icon:"ra-anvil",name:"Rasgo: Herrer&iacute;a"},"r:protector":{icon:"ra-shield",name:"Rasgo: Protector"},"r:paz":{icon:"ra-two-hearts",name:"Rasgo: Aura de Paz"},"r:lengua":{icon:"ra-speech-bubbles",name:"Rasgo: Lenguaje"},"r:escribir":{icon:"ra-quill-ink",name:"Rasgo: Leer y Escribir"},"r:adiccion":{icon:"ra-beer",name:"Rasgo: Adicci&oacute;n"},"r:hurtar":{icon:"ra-nuclear",name:"Rasgo: Hurtar"},"r:interrogar":{icon:"ra-gears",name:"Rasgo: Interrogar"},"r:pacifista":{icon:"ra-cancel",name:"Rasgo: Pacifista"},"a:ligera":{icon:"ra-knight-helmet",name:"Aptitud: Armadura Ligera"},"a:pesada":{icon:"ra-helmet",name:"Aptitud: Armadura Pesada"},"a:tunica":{icon:"ra-vest",name:"Aptitud: T&uacute;nica"},"a:escudo":{icon:" ra-round-shield",name:"Aptitud: Escudo"},"a:torre":{icon:"ra-eye-shield",name:"Aptitud: Escudo Torre"},"a:desarmado":{icon:"ra-hand",name:"Adiestramiento: Combate Desarmado"}},$pjs.views.translateEffects=function(a){return a?($.each($pjs.views.translateDict,function(e,i){a=a.replace(e,'<i title="'+i.name+'" class="ra '+i.icon+'"></i>')}),a):""},$pjs.views.link=function(a,e){return $("<a href=\"javascript:void(0, '"+a+"')\">"+e+"</a>").linkTo(a)},$.fn.linkTo=function(a){return this.on("click",function(e){switch(e.preventDefault(),e.which){case 1:$pjs.router.navigate(a);break;case 2:window.open($pjs.router.link(a),"_blank")}})},$.fn.addLinkTo=function(a,e){return this.append($pjs.views.link(a,e))},function(a){a.fn.pejotas=function(a){$pjs.render(this)}}(jQuery);for(var defaultDiacriticsRemovalMap=[{base:"a",letters:"aⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐ"},{base:"e",letters:"eⓔｅèéêềếễểẽēḕḗĕėëẻěȅȇẹệȩḝęḙḛɇɛǝ"},{base:"i",letters:"iⓘｉìíîĩīĭïḯỉǐȉȋịįḭɨı"},{base:"o",letters:"oⓞｏòóôồốỗổõṍȭṏōṑṓŏȯȱöȫỏőǒȍȏơờớỡởợọộǫǭøǿɔꝋꝍɵ"},{base:"u",letters:"uⓤｕùúûũṹūṻŭüǜǘǖǚủůűǔȕȗưừứữửựụṳųṷṵʉ"},{base:"n",letters:"nⓝｎǹńñṅňṇņṋṉƞɲŉꞑꞥ"},{base:"-",letters:" "},{base:"",letters:"!.¡´"}],diacriticsMap={},i=0;i<defaultDiacriticsRemovalMap.length;i++)for(var letters=defaultDiacriticsRemovalMap[i].letters,j=0;j<letters.length;j++)diacriticsMap[letters[j]]=defaultDiacriticsRemovalMap[i].base;$pjs.nameToClass=function(a){return a.toLowerCase().replace(/[^a-z0-9]/g,function(a){return"undefined"!=typeof diacriticsMap[a]?diacriticsMap[a]:a})};